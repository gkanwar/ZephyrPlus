/** @preserve
 Copyright (c) 2010, Linden Research, Inc.
 Copyright (c) 2012, Joshua Bell

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 $/LicenseInfo$
 */
/**
 * @preserve Copyright (c) 2013 David Benjamin and Alan Huang
 * Use of this source code is governed by an MIT-style license that
 * can be found at
 * https://github.com/davidben/webathena
 */
function log(a){"undefined"!=typeof console&&console.log&&console.log(a)}!function(a){"use strict";function b(){try{return document&&document.createTextNode("").splitText(1),new RangeError("INDEX_SIZE_ERR")}catch(a){return a}}function c(a){if(Object.getOwnPropertyNames&&Object.defineProperty){var b,c=Object.getOwnPropertyNames(a);for(b=0;b<c.length;b+=1)Object.defineProperty(a,c[b],{value:a[c[b]],writable:!1,enumerable:!1,configurable:!1})}}function d(a){function b(b){Object.defineProperty(a,b,{get:function(){return a._getter(b)},set:function(c){a._setter(b,c)},enumerable:!0,configurable:!1})}if(Object.defineProperty){var c;for(c=0;c<a.length;c+=1)b(c)}}function e(a,b){var c=32-b;return a<<c>>c}function f(a,b){var c=32-b;return a<<c>>>c}function g(a){return[255&a]}function h(a){return e(a[0],8)}function i(a){return[255&a]}function j(a){return f(a[0],8)}function k(a){return a=Math.round(Number(a)),[0>a?0:a>255?255:255&a]}function l(a){return[255&a>>8,255&a]}function m(a){return e(a[0]<<8|a[1],16)}function n(a){return[255&a>>8,255&a]}function o(a){return f(a[0]<<8|a[1],16)}function p(a){return[255&a>>24,255&a>>16,255&a>>8,255&a]}function q(a){return e(a[0]<<24|a[1]<<16|a[2]<<8|a[3],32)}function r(a){return[255&a>>24,255&a>>16,255&a>>8,255&a]}function s(a){return f(a[0]<<24|a[1]<<16|a[2]<<8|a[3],32)}function t(a,b,c){var d,e,f,g,h,i,j,k,l=(1<<b-1)-1;for(a!==a?(e=(1<<l)-1,f=Math.pow(2,c-1),d=0):1/0===a||a===-1/0?(e=(1<<l)-1,f=0,d=0>a?1:0):0===a?(e=0,f=0,d=1/a===-1/0?1:0):(d=0>a,a=Math.abs(a),a>=Math.pow(2,1-l)?(g=Math.min(Math.floor(Math.log(a)/Math.LN2),l),e=g+l,f=Math.round(a*Math.pow(2,c-g)-Math.pow(2,c))):(e=0,f=Math.round(a/Math.pow(2,1-l-c)))),i=[],h=c;h;h-=1)i.push(f%2?1:0),f=Math.floor(f/2);for(h=b;h;h-=1)i.push(e%2?1:0),e=Math.floor(e/2);for(i.push(d?1:0),i.reverse(),j=i.join(""),k=[];j.length;)k.push(parseInt(j.substring(0,8),2)),j=j.substring(8);return k}function u(a,b,c){var d,e,f,g,h,i,j,k,l=[];for(d=a.length;d;d-=1)for(f=a[d-1],e=8;e;e-=1)l.push(f%2?1:0),f>>=1;return l.reverse(),g=l.join(""),h=(1<<b-1)-1,i=parseInt(g.substring(0,1),2)?-1:1,j=parseInt(g.substring(1,1+b),2),k=parseInt(g.substring(1+b),2),j===(1<<b)-1?0!==k?0/0:1/0*i:j>0?i*Math.pow(2,j-h)*(1+k/Math.pow(2,c)):0!==k?i*Math.pow(2,-(h-1))*(k/Math.pow(2,c)):0>i?-0:0}function v(a){return u(a,11,52)}function w(a){return t(a,11,52)}function x(a){return u(a,8,23)}function y(a){return t(a,8,23)}var z=!0,A=function(){var a=Object.prototype.toString,b=Object.prototype.hasOwnProperty;return{Class:function(b){return a.call(b).replace(/^\[object *|\]$/g,"")},HasProperty:function(a,b){return b in a},HasOwnProperty:function(a,c){return b.call(a,c)},IsCallable:function(a){return"function"==typeof a},ToInt32:function(a){return a>>0},ToUint32:function(a){return a>>>0}}}();Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(a){return!1}}()||(Object.defineProperty=function(a,b,c){if(!a===Object(a))throw new TypeError("Object.defineProperty called on non-object");return A.HasProperty(c,"get")&&Object.prototype.__defineGetter__&&Object.prototype.__defineGetter__.call(a,b,c.get),A.HasProperty(c,"set")&&Object.prototype.__defineSetter__&&Object.prototype.__defineSetter__.call(a,b,c.set),A.HasProperty(c,"value")&&(a[b]=c.value),a}),Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(a){if(a!==Object(a))throw new TypeError("Object.getOwnPropertyNames called on non-object");var b,c=[];for(b in a)A.HasOwnProperty(a,b)&&c.push(b);return c}),function(){function e(a,e,g){var h;return h=function(a,e,g){var i,j,k,l;if(arguments.length&&"number"!=typeof arguments[0])if("object"==typeof arguments[0]&&arguments[0].constructor===h)for(i=arguments[0],this.length=i.length,this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new f(this.byteLength),this.byteOffset=0,k=0;k<this.length;k+=1)this._setter(k,i._getter(k));else if("object"!=typeof arguments[0]||arguments[0]instanceof f||"ArrayBuffer"===A.Class(arguments[0])){if("object"!=typeof arguments[0]||!(arguments[0]instanceof f||"ArrayBuffer"===A.Class(arguments[0])))throw new TypeError("Unexpected argument type(s)");if(this.buffer=a,this.byteOffset=A.ToUint32(e),this.byteOffset>this.buffer.byteLength)throw b();if(this.byteOffset%this.BYTES_PER_ELEMENT)throw new RangeError("ArrayBuffer length minus the byteOffset is not a multiple of the element size.");if(arguments.length<3){if(this.byteLength=this.buffer.byteLength-this.byteOffset,this.byteLength%this.BYTES_PER_ELEMENT)throw b();this.length=this.byteLength/this.BYTES_PER_ELEMENT}else this.length=A.ToUint32(g),this.byteLength=this.length*this.BYTES_PER_ELEMENT;if(this.byteOffset+this.byteLength>this.buffer.byteLength)throw b()}else for(j=arguments[0],this.length=A.ToUint32(j.length),this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new f(this.byteLength),this.byteOffset=0,k=0;k<this.length;k+=1)l=j[k],this._setter(k,Number(l));else{if(this.length=A.ToInt32(arguments[0]),0>g)throw new RangeError("ArrayBufferView size is not a small enough positive integer.");this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new f(this.byteLength),this.byteOffset=0}this.constructor=h,c(this),d(this)},h.prototype=new t,h.prototype.BYTES_PER_ELEMENT=a,h.prototype._pack=e,h.prototype._unpack=g,h.BYTES_PER_ELEMENT=a,h.prototype._getter=function(a){if(arguments.length<1)throw new SyntaxError("Not enough arguments");if(a=A.ToUint32(a),a>=this.length)return void 0;var b,c,d=[];for(b=0,c=this.byteOffset+a*this.BYTES_PER_ELEMENT;b<this.BYTES_PER_ELEMENT;b+=1,c+=1)d.push(this.buffer._bytes[c]);return this._unpack(d)},h.prototype.get=h.prototype._getter,h.prototype._setter=function(a,b){if(arguments.length<2)throw new SyntaxError("Not enough arguments");if(a=A.ToUint32(a),!(a>=this.length)){var c,d,e=this._pack(b);for(c=0,d=this.byteOffset+a*this.BYTES_PER_ELEMENT;c<this.BYTES_PER_ELEMENT;c+=1,d+=1)this.buffer._bytes[d]=e[c]}},h.prototype.set=function(){if(arguments.length<1)throw new SyntaxError("Not enough arguments");var a,c,d,e,f,g,h,i,j,k;if("object"==typeof arguments[0]&&arguments[0].constructor===this.constructor){if(a=arguments[0],d=A.ToUint32(arguments[1]),d+a.length>this.length)throw b();if(i=this.byteOffset+d*this.BYTES_PER_ELEMENT,j=a.length*this.BYTES_PER_ELEMENT,a.buffer===this.buffer){for(k=[],f=0,g=a.byteOffset;j>f;f+=1,g+=1)k[f]=a.buffer._bytes[g];for(f=0,h=i;j>f;f+=1,h+=1)this.buffer._bytes[h]=k[f]}else for(f=0,g=a.byteOffset,h=i;j>f;f+=1,g+=1,h+=1)this.buffer._bytes[h]=a.buffer._bytes[g]}else{if("object"!=typeof arguments[0]||"undefined"==typeof arguments[0].length)throw new TypeError("Unexpected argument type(s)");if(c=arguments[0],e=A.ToUint32(c.length),d=A.ToUint32(arguments[1]),d+e>this.length)throw b();for(f=0;e>f;f+=1)g=c[f],this._setter(d+f,Number(g))}},h.prototype.subarray=function(a,b){function c(a,b,c){return b>a?b:a>c?c:a}a=A.ToInt32(a),b=A.ToInt32(b),arguments.length<1&&(a=0),arguments.length<2&&(b=this.length),0>a&&(a=this.length+a),0>b&&(b=this.length+b),a=c(a,0,this.length),b=c(b,0,this.length);var d=b-a;return 0>d&&(d=0),new this.constructor(this.buffer,this.byteOffset+a*this.BYTES_PER_ELEMENT,d)},h}var f=function(a){if(a=A.ToInt32(a),0>a)throw new RangeError("ArrayBuffer size is not a small enough positive integer.");this.byteLength=a,this._bytes=[],this._bytes.length=a;var b;for(b=0;b<this.byteLength;b+=1)this._bytes[b]=0;c(this)},t=function(){},u=e(1,g,h),B=e(1,i,j),C=e(1,k,j),D=e(2,l,m),E=e(2,n,o),F=e(4,p,q),G=e(4,r,s),H=e(4,y,x),I=e(8,w,v);z?(a.ArrayBuffer=a.ArrayBuffer||f,a.Int8Array=a.Int8Array||u,a.Uint8Array=a.Uint8Array||B,a.Uint8ClampedArray=a.Uint8ClampedArray||C,a.Int16Array=a.Int16Array||D,a.Uint16Array=a.Uint16Array||E,a.Int32Array=a.Int32Array||F,a.Uint32Array=a.Uint32Array||G,a.Float32Array=a.Float32Array||H,a.Float64Array=a.Float64Array||I):(a.ArrayBuffer=f,a.Int8Array=u,a.Uint8Array=B,a.Uint8ClampedArray=C,a.Int16Array=D,a.Uint16Array=E,a.Int32Array=F,a.Uint32Array=G,a.Float32Array=H,a.Float64Array=I)}(),function(){function d(a,b){return A.IsCallable(a.get)?a.get(b):a[b]}function e(a){return function(c,e){if(c=A.ToUint32(c),c+a.BYTES_PER_ELEMENT>this.byteLength)throw b();c+=this.byteOffset;var f,h=new Uint8Array(this.buffer,c,a.BYTES_PER_ELEMENT),i=[];for(f=0;f<a.BYTES_PER_ELEMENT;f+=1)i.push(d(h,f));return Boolean(e)===Boolean(g)&&i.reverse(),d(new a(new Uint8Array(i).buffer),0)}}function f(a){return function(c,e,f){if(c=A.ToUint32(c),c+a.BYTES_PER_ELEMENT>this.byteLength)throw b();var h,i,j=new a([e]),k=new Uint8Array(j.buffer),l=[];for(h=0;h<a.BYTES_PER_ELEMENT;h+=1)l.push(d(k,h));Boolean(f)===Boolean(g)&&l.reverse(),i=new Uint8Array(this.buffer,c,a.BYTES_PER_ELEMENT),i.set(l)}}var g=function(){var a=new Uint16Array([4660]),b=new Uint8Array(a.buffer);return 18===d(b,0)}(),h=function(a,d,e){if(0===arguments.length)a=new ArrayBuffer(0);else if(!(a instanceof ArrayBuffer||"ArrayBuffer"===A.Class(a)))throw new TypeError("TypeError");if(this.buffer=a||new ArrayBuffer(0),this.byteOffset=A.ToUint32(d),this.byteOffset>this.buffer.byteLength)throw b();if(this.byteLength=arguments.length<3?this.buffer.byteLength-this.byteOffset:A.ToUint32(e),this.byteOffset+this.byteLength>this.buffer.byteLength)throw b();c(this)};h.prototype.getUint8=e(Uint8Array),h.prototype.getInt8=e(Int8Array),h.prototype.getUint16=e(Uint16Array),h.prototype.getInt16=e(Int16Array),h.prototype.getUint32=e(Uint32Array),h.prototype.getInt32=e(Int32Array),h.prototype.getFloat32=e(Float32Array),h.prototype.getFloat64=e(Float64Array),h.prototype.setUint8=f(Uint8Array),h.prototype.setInt8=f(Int8Array),h.prototype.setUint16=f(Uint16Array),h.prototype.setInt16=f(Int16Array),h.prototype.setUint32=f(Uint32Array),h.prototype.setInt32=f(Int32Array),h.prototype.setFloat32=f(Float32Array),h.prototype.setFloat64=f(Float64Array),a.DataView=z?a.DataView||h:h}()}(this),window.atob&&window.btoa||function(){var a={fromBits:function(a){var b,c,d="",e=sjcl.bitArray.bitLength(a);for(b=0;e/8>b;b++)0===(3&b)&&(c=a[b/4]),d+=String.fromCharCode(c>>>24),c<<=8;return d},toBits:function(a){var b,c=[],d=0;for(b=0;b<a.length;b++)d=d<<8|a.charCodeAt(b),3===(3&b)&&(c.push(d),d=0);return 3&b&&c.push(sjcl.bitArray.partial(8*(3&b),d)),c}};window.atob=function(b){return a.fromBits(sjcl.codec.base64.toBits(b))},window.btoa=function(b){return sjcl.codec.base64.fromBits(a.toBits(b))}}(),window.Uint8Array&&0!==new Uint8Array(1).subarray(1).byteLength&&function(){for(var a=function(a,b){function c(a,b,c){return b>a?b:a>c?c:a}a=0|a,b=0|b,arguments.length<1&&(a=0),arguments.length<2&&(b=this.length),0>a&&(a=this.length+a),0>b&&(b=this.length+b),a=c(a,0,this.length),b=c(b,0,this.length);var d=b-a;return 0>d&&(d=0),new this.constructor(this.buffer,this.byteOffset+a*this.BYTES_PER_ELEMENT,d)},b=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"],c=0;c<b.length;c++)window[b[c]]&&(window[b[c]].prototype.subarray=a)}(),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){return b=b||0,this.substr(b,a.length)===a}});var arrayutils=function(){"use strict";var a={};if(a.asUint8Array=function(a){return a instanceof Uint8Array?a:new Uint8Array(a.buffer,a.byteOffset,a.byteLength)},a.fromByteString=function(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b},Uint8Array.prototype._getter)a.toByteString=function(b){b=a.asUint8Array(b);for(var c="",d=0;d<b.length;d++)c+=String.fromCharCode(b._getter(d));return c};else try{String.fromCharCode.apply(String,new Uint8Array([1,2,3])),a.toByteString=function(b){return String.fromCharCode.apply(String,a.asUint8Array(b))}}catch(b){a.toByteString=function(b){b=a.asUint8Array(b);for(var c="",d=0;d<b.length;d++)c+=String.fromCharCode(b[d]);return c}}return a.fromString=function(b){return a.fromByteString(unescape(encodeURIComponent(b)))},a.toString=function(b){return decodeURIComponent(escape(a.toByteString(b)))},a.fromBase64=function(b){return a.fromByteString(atob(b))},a.toBase64=function(b){return btoa(a.toByteString(b))},a.fromSJCL=function(a){var b,c,d=sjcl.bitArray.bitLength(a),e=new Uint8Array(d>>>3);for(b=0;d/8>b;b++)0===(3&b)&&(c=a[b/4]),e[b]=c>>>24,c<<=8;return e},a.toSJCL=function(b){b=a.asUint8Array(b);var c,d=[],e=0;for(c=0;c<b.length;c++)e=e<<8|b[c],3===(3&c)&&(d.push(e),e=0);return 3&c&&d.push(sjcl.bitArray.partial(8*(3&c),e)),d},a.equals=function(b,c){if(b=a.asUint8Array(b),c=a.asUint8Array(c),b.length!==c.length)return!1;for(var d=0;d<b.length;d++)if(b[d]!==c[d])return!1;return!0},a}(),asn1={};if(asn1.TAG_UNIVERSAL=0,asn1.TAG_APPLICATION=64,asn1.TAG_CONTEXT=128,asn1.TAG_PRIVATE=192,asn1.TAG_PRIMITIVE=0,asn1.TAG_CONSTRUCTED=32,asn1.Error=function(a){this.message=a},asn1.Error.prototype.toString=function(){return"ASN.1 error: "+this.message},asn1.tag=function(a,b,c){if(void 0===b&&(b=asn1.TAG_CONTEXT),void 0===c&&(c=asn1.TAG_PRIMITIVE),a>=31)throw new asn1.Error("High-tag-number form not implemented!");return a|b|c},asn1.Buffer=function(){this.buffer=new Uint8Array(10),this.start=10},asn1.Buffer.prototype.reserve=function(a){if(!(this.start>=a)){for(var b=a-this.start+this.buffer.byteLength,c=this.buffer.byteLength;b>c;)c*=2;var d=new Uint8Array(c);d.set(this.buffer,c-this.buffer.byteLength),this.start+=c-this.buffer.byteLength,this.buffer=d}},asn1.Buffer.prototype.prependUint8=function(a){return this.reserve(1),this.start-=1,this.buffer[this.start]=a,1},asn1.Buffer.prototype.prependUint32=function(a,b){return b?this.prependBytes([255&a,255&a>>>8,255&a>>>16,a>>>24]):this.prependBytes([a>>>24,255&a>>>16,255&a>>>8,255&a])},asn1.Buffer.prototype.prependUint16=function(a,b){return b?this.prependBytes([255&a,a>>>8]):this.prependBytes([a>>>8,255&a])},asn1.Buffer.prototype.prependBytes=function(a){return a instanceof Array||(a=arrayutils.asUint8Array(a)),this.reserve(a.length),this.start-=a.length,this.buffer.set(a,this.start),a.length},asn1.Buffer.prototype.contents=function(){return this.buffer.subarray(this.start)},asn1.encodeTagDER=function(a,b){return b.prependUint8(a)},asn1.encodeLengthDER=function(a,b){if(127>=a)return b.prependUint8(a);for(var c=0;a>0;)b.prependUint8(255&a),a>>=8,c++;return b.prependUint8(128|c),c+1},asn1.decodeTagLengthValueDER=function(a){var b=0,c=a[b],d=31&c,e=32&c,f=192&c;if(31==d)throw new asn1.Error("High-tag-number form not implemented!");var g=asn1.tag(d,f,e);b++;var h=a[b],i=0;if(b++,0==(128&h))i=h;else{if(128==h)throw new asn1.Error("Indefinite-length method unsupported!");for(var j=127&h,k=0;j>k;k++,b++)i*=256,i+=a[b]}if(b+i>a.length)throw new asn1.Error("Length too large!");return[g,a.subarray(b,b+i),a.subarray(b+i)]},asn1.Type=function(a,b){this.primitive=b?!0:!1,this.primitive||(a|=asn1.TAG_CONSTRUCTED),this.tag=a},asn1.Type.prototype.encodeDER=function(a){var b=new asn1.Buffer;return this.encodeDERTriple(a,b),b.contents()},asn1.Type.prototype.encodeDERTriple=function(a,b){var c=this.encodeDERValue(a,b);return c+=asn1.encodeLengthDER(c,b),c+=asn1.encodeTagDER(this.tag,b)},asn1.Type.prototype.decodeDER=function(a){var b=this.decodeDERPrefix(a),c=b[0],d=b[1];if(0!=d.byteLength)throw new asn1.Error("Excess data!");return c},asn1.Type.prototype.decodeDERPrefix=function(a){a=new Uint8Array(a);var b=asn1.decodeTagLengthValueDER(a),c=b[0],d=b[1],e=b[2];if(c!=this.tag)throw new asn1.Error("Tag mismatch!");return[this.decodeDERValue(d),e]},asn1.Type.prototype.tagged=function(a){return new asn1.ExplicitlyTagged(a,this)},asn1.Type.prototype.implicitlyTagged=function(a){return new asn1.ImplicitlyTagged(a,this)},asn1.Type.prototype.constrained=function(a){var b=this.subtype(),c=this;return b.encodeDERValue=function(b,d){return a.call(this,b),c.encodeDERValue(b,d)},b.decodeDERValue=function(b){var d=c.decodeDERValue(b);return a.call(this,d),d},b},asn1.Type.prototype.subtype=function(){return Object.create(this)},asn1.ExplicitlyTagged=function(a,b){asn1.Type.call(this,a,!1),this.baseType=b},asn1.ExplicitlyTagged.prototype=Object.create(asn1.Type.prototype),asn1.ExplicitlyTagged.prototype.encodeDERValue=function(a,b){return this.baseType.encodeDERTriple(a,b)},asn1.ExplicitlyTagged.prototype.decodeDERValue=function(a){return this.baseType.decodeDER(a)},asn1.ImplicitlyTagged=function(a,b){asn1.Type.call(this,a,b.primitive),this.baseType=b},asn1.ImplicitlyTagged.prototype=Object.create(asn1.Type.prototype),asn1.ImplicitlyTagged.prototype.encodeDERValue=function(a,b){return this.baseType.encodeDERValue(a,b)},asn1.ImplicitlyTagged.prototype.decodeDERValue=function(a){return this.baseType.decodeDERValue(a)},asn1.BOOLEAN=new asn1.Type(asn1.tag(1,asn1.TAG_UNIVERSAL),!0),asn1.BOOLEAN.encodeDERValue=function(a,b){if("boolean"!=typeof a)throw new TypeError("boolean");return b.prependUint8(a?255:0)},asn1.BOOLEAN.decodeDERValue=function(a){return 0!==a[0]},asn1.INTEGER=new asn1.Type(asn1.tag(2,asn1.TAG_UNIVERSAL),!0),asn1.INTEGER.encodeDERValue=function(a,b){var c,d=0;if("number"!=typeof a)throw new TypeError("Not a number");do{var e=255&a;d+=b.prependUint8(e),c=128&e?-1:0,a>>=8}while(a!==c);return d},asn1.INTEGER.decodeDERValue=function(a){var b=a[0];b>127&&(b-=256);for(var c=1;c<a.length;c++)b*=256,b+=a[c];return b},asn1.INTEGER.valueConstrained=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);return this.constrained(function(b){if(-1==a.indexOf(b))throw new RangeError("Invalid value: "+b)})},asn1.INTEGER.rangeConstrained=function(a,b){return this.constrained(function(c){if(a>c||c>b)throw new RangeError("Invalid value: "+c)})},asn1.BIT_STRING=new asn1.Type(asn1.tag(3,asn1.TAG_UNIVERSAL),!0),asn1.BIT_STRING.encodeDERValue=function(a,b){var c=8-a.length%8;8==c&&(c=0);for(var d=0,e=a.length+c-8;e>=0;e-=8){for(var f=0,g=0;8>g;g++)f|=(a[e+g]||0)<<7-g;d+=b.prependUint8(f)}return d+=b.prependUint8(c)},asn1.BIT_STRING.decodeDERValue=function(a){for(var b=a[0],c=[],d=1;d<a.length;d++)for(var e=a[d],f=7;f>=0;f--)c.push(e&1<<f?1:0);return c.slice(0,c.length-b)},asn1.OCTET_STRING=new asn1.Type(asn1.tag(4,asn1.TAG_UNIVERSAL),!0),asn1.OCTET_STRING.encodeDERValue=function(a,b){if("undefined"!=typeof ArrayBufferView&&!a instanceof ArrayBufferView)throw new TypeError("Not an array buffer");return b.prependBytes(a)},asn1.OCTET_STRING.decodeDERValue=function(a){return new Uint8Array(a)},asn1.NULL=new asn1.Type(asn1.tag(5,asn1.TAG_UNIVERSAL),!0),asn1.NULL.encodeDERValue=function(a){if(null!==a)throw new TypeError("Bad value");return 0},asn1.NULL.decodeDERValue=function(a){if(a.length>0)throw new asn1.Error("Bad encoding");return null},asn1.OBJECT_IDENTIFIER=new asn1.Type(asn1.tag(6,asn1.TAG_UNIVERSAL),!0),asn1.OBJECT_IDENTIFIER.encodeDERValue=function(a,b){if("string"!=typeof a)throw new TypeError("Not a string");var c=a.split(".");if(c.length<2)throw new TypeError("Too few components");for(var d=[40*Number(c[0])+Number(c[1])],e=2;e<c.length;e++)d.push(Number(c[e]));for(var f=0,e=d.length-1;e>=0;e--){var g=d[e];for(f+=b.prependUint8(127&g),g>>>=7;g>0;)f+=b.prependUint8(128|127&g),g>>>=7}return f},asn1.OBJECT_IDENTIFIER.decodeDERValue=function(a){for(var b=0,c=[],d=0;d<a.length;d++){var e=a[d];b*=128,b+=127&e,128&e||(c.push(b),b=0)}if(0===c.length)throw new asn1.Error("Bad format");var f=[],g=Math.min(c[0]/40>>>0,2),f=[g,c[0]-40*g];return f=f.concat(c.slice(1)),f.join(".")},asn1.GeneralString=new asn1.Type(asn1.tag(27,asn1.TAG_UNIVERSAL),!0),asn1.GeneralString.encodeDERValue=function(a,b){if("string"!=typeof a)throw new TypeError("Not a string");return b.prependBytes(arrayutils.fromString(a))},asn1.GeneralString.decodeDERValue=function(a){try{return arrayutils.toString(a)}catch(b){if(b instanceof URIError)throw new asn1.Error("Invalid UTF-8 string");throw b}},asn1.GeneralizedTime=new asn1.Type(asn1.tag(24,asn1.TAG_UNIVERSAL),!0),asn1.GeneralizedTime.encodeDERValue=function(a,b){function c(a,b){void 0==b&&(b=2);for(var c=String(a);c.length<b;)c="0"+c;return c}var d=a.getUTCFullYear()+c(a.getUTCMonth()+1)+c(a.getUTCDate())+c(a.getUTCHours())+c(a.getUTCMinutes())+c(a.getUTCSeconds());if(0!=a.getUTCMilliseconds()){for(var e=c(a.getUTCMilliseconds(),3);"0"==e[e.length-1];)e=e.substr(0,e.length-1);d+="."+e}return d+="Z",b.prependBytes(arrayutils.fromByteString(d))},asn1.GeneralizedTime.decodeDERValue=function(a){var b=/^(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\.(\d{1,3}))?Z$/,c=arrayutils.toByteString(a).match(b);if(!c)throw new asn1.Error("Bad date format");var d=new Date(Date.UTC(Number(c[1]),Number(c[2])-1,Number(c[3]),Number(c[4]),Number(c[5]),Number(c[6])));if(c[8]){for(var e=c[8];e.length<3;)e+="0";d.setUTCMilliseconds(Number(e))}return d},asn1.SEQUENCE_OF=function(a){asn1.Type.call(this,asn1.tag(16,asn1.TAG_UNIVERSAL),!1),this.componentType=a},asn1.SEQUENCE_OF.prototype=Object.create(asn1.Type.prototype),asn1.SEQUENCE_OF.prototype.encodeDERValue=function(a,b){for(var c=0,d=a.length-1;d>=0;d--)c+=this.componentType.encodeDERTriple(a[d],b);return c},asn1.SEQUENCE_OF.prototype.decodeDERValue=function(a){for(var b=[];a.length;){var c=this.componentType.decodeDERPrefix(a);b.push(c[0]),a=c[1]}return b},asn1.SEQUENCE=function(a){asn1.Type.call(this,asn1.tag(16,asn1.TAG_UNIVERSAL),!1),this.componentSpec=a},asn1.SEQUENCE.prototype=Object.create(asn1.Type.prototype),asn1.SEQUENCE.prototype.encodeDERValue=function(a,b){for(var c=0,d=this.componentSpec.length-1;d>=0;d--){var e=this.componentSpec[d].id;if(e in a)c+=this.componentSpec[d].type.encodeDERTriple(a[e],b);else if(!this.componentSpec[d].optional)throw new TypeError("Field "+e+" missing!")}return c},asn1.SEQUENCE.prototype.decodeDERValue=function(a){for(var b={},c=0;a.length;){for(var d=asn1.decodeTagLengthValueDER(a),e=d[0],f=d[1],g=d[2];c<this.componentSpec.length&&this.componentSpec[c].type.tag!=e;){if(!this.componentSpec[c].optional)throw new asn1.Error("Missing required field "+this.componentSpec[c].id);c++}if(c>=this.componentSpec.length)throw new asn1.Error("Unexpected tag "+e);b[this.componentSpec[c].id]=this.componentSpec[c].type.decodeDERValue(f),a=g,c++}for(;c<this.componentSpec.length;){if(!this.componentSpec[c].optional)throw new asn1.Error("Missing required field "+this.componentSpec[c].id);c++}return b},asn1.CHOICE=function(a){this.choices=a},asn1.CHOICE.prototype=Object.create(asn1.Type.prototype),asn1.CHOICE.prototype.encodeDERTriple=function(a,b){var c=a[0],d=a[1];if(-1==this.choices.indexOf(c))throw new TypeError("Invalid type");return c.encodeDERTriple(d,b)},asn1.CHOICE.prototype.decodeDERPrefix=function(a){for(var b=asn1.decodeTagLengthValueDER(a),c=b[0],d=b[1],e=b[2],f=0;f<this.choices.length;f++)if(c==this.choices[f].tag)return[[this.choices[f],this.choices[f].decodeDERValue(d)],e];throw new asn1.Error("Unexpected tag "+c)},"object"==typeof exports&&(module.exports=asn1),"undefined"==typeof asn1&&"function"==typeof require)var asn1=require("./asn1.js");var krb={};krb.KerberosString=asn1.GeneralString,krb.Int32=asn1.INTEGER.rangeConstrained(-2147483648,2147483647),krb.UInt32=asn1.INTEGER.rangeConstrained(0,4294967295),krb.Microseconds=asn1.INTEGER.rangeConstrained(0,999999),krb.Realm=krb.KerberosString,krb.PrincipalName=new asn1.SEQUENCE([{id:"nameType",type:krb.Int32.tagged(asn1.tag(0))},{id:"nameString",type:new asn1.SEQUENCE_OF(krb.KerberosString).tagged(asn1.tag(1))}]),krb.principalNamesEqual=function(a,b){if(a.nameString.length!=b.nameString.length)return!1;for(var c=0;c<a.nameString.length;c++)if(a.nameString[c]!=b.nameString[c])return!1;return!0},krb.KerberosTime=asn1.GeneralizedTime.constrained(function(a){if(0!=a.getUTCMilliseconds())throw"Milliseconds not allowed in KerberosTime"}),krb.HostAddress=new asn1.SEQUENCE([{id:"addrType",type:krb.Int32.tagged(asn1.tag(0))},{id:"address",type:asn1.OCTET_STRING.tagged(asn1.tag(1))}]),krb.HostAddresses=new asn1.SEQUENCE_OF(krb.HostAddress),krb.AuthorizationData=new asn1.SEQUENCE_OF(new asn1.SEQUENCE([{id:"adType",type:krb.Int32.tagged(asn1.tag(0))},{id:"adData",type:asn1.OCTET_STRING.tagged(asn1.tag(1))}])),krb.AD_IF_RELEVANT=krb.AuthorizationData,krb.EncryptedData=new asn1.SEQUENCE([{id:"etype",type:krb.Int32.tagged(asn1.tag(0))},{id:"kvno",type:krb.UInt32.tagged(asn1.tag(1)),optional:!0},{id:"cipher",type:asn1.OCTET_STRING.tagged(asn1.tag(2))}]),krb.EncryptionKey=new asn1.SEQUENCE([{id:"keytype",type:krb.Int32.tagged(asn1.tag(0))},{id:"keyvalue",type:asn1.OCTET_STRING.tagged(asn1.tag(1))}]),krb.Checksum=new asn1.SEQUENCE([{id:"cksumtype",type:krb.Int32.tagged(asn1.tag(0))},{id:"checksum",type:asn1.OCTET_STRING.tagged(asn1.tag(1))}]),krb.AD_KDCIssued=new asn1.SEQUENCE([{id:"adChecksum",type:krb.Checksum.tagged(asn1.tag(0))},{id:"iRealm",type:krb.Realm.tagged(asn1.tag(1)),optional:!0},{id:"iSname",type:krb.PrincipalName.tagged(asn1.tag(2)),optional:!0},{id:"elements",type:krb.AuthorizationData.tagged(asn1.tag(3))}]),krb.AD_AND_OR=new asn1.SEQUENCE([{id:"conditionCount",type:krb.Int32.tagged(asn1.tag(0))},{id:"elements",type:krb.AuthorizationData.tagged(asn1.tag(1))}]),krb.AD_MANDATORY_FOR_KDC=krb.AuthorizationData,krb.PA_DATA=new asn1.SEQUENCE([{id:"padataType",type:krb.Int32.tagged(asn1.tag(1))},{id:"padataValue",type:asn1.OCTET_STRING.tagged(asn1.tag(2))}]),krb.ENC_TIMESTAMP=krb.EncryptedData,krb.ENC_TS_ENC=new asn1.SEQUENCE([{id:"patimestamp",type:krb.KerberosTime.tagged(asn1.tag(0))},{id:"pausec",type:krb.Microseconds.tagged(asn1.tag(1)),optional:!0}]),krb.ETYPE_INFO_ENTRY=new asn1.SEQUENCE([{id:"etype",type:krb.Int32.tagged(asn1.tag(0))},{id:"salt",type:asn1.OCTET_STRING.tagged(asn1.tag(1)),optional:!0}]),krb.ETYPE_INFO=new asn1.SEQUENCE_OF(krb.ETYPE_INFO_ENTRY),krb.ETYPE_INFO2_ENTRY=new asn1.SEQUENCE([{id:"etype",type:krb.Int32.tagged(asn1.tag(0))},{id:"salt",type:krb.KerberosString.tagged(asn1.tag(1)),optional:!0},{id:"s2kparams",type:asn1.OCTET_STRING.tagged(asn1.tag(2)),optional:!0}]),krb.ETYPE_INFO2=new asn1.SEQUENCE_OF(krb.ETYPE_INFO2_ENTRY),krb.KerberosFlags=asn1.BIT_STRING.constrained(function(a){if(a.length<32)throw"Invalid KerberosFlags"}),krb.KerberosFlags.makeZeroFlags=function(a){a=a||32;for(var b=[],c=0;a>c;c++)b.push(0);return b},krb.KerberosFlags.make=function(){for(var a=32,b=0;b<arguments.length;b++)a=Math.max(a,arguments[b]);for(var c=this.makeZeroFlags(a),b=0;b<arguments.length;b++)c[arguments[b]]=1;return c},krb.Ticket=new asn1.SEQUENCE([{id:"tktVno",type:asn1.INTEGER.valueConstrained(5).tagged(asn1.tag(0))},{id:"realm",type:krb.Realm.tagged(asn1.tag(1))},{id:"sname",type:krb.PrincipalName.tagged(asn1.tag(2))},{id:"encPart",type:krb.EncryptedData.tagged(asn1.tag(3))}]).tagged(asn1.tag(1,asn1.TAG_APPLICATION)),krb.TicketFlags=krb.KerberosFlags.subtype(),krb.TicketFlags.reserved=0,krb.TicketFlags.forwardable=1,krb.TicketFlags.forwarded=2,krb.TicketFlags.proxiable=3,krb.TicketFlags.proxy=4,krb.TicketFlags.may_postdate=5,krb.TicketFlags.postdated=6,krb.TicketFlags.invalid=7,krb.TicketFlags.renewable=8,krb.TicketFlags.initial=9,krb.TicketFlags.pre_authent=10,krb.TicketFlags.hw_authent=11,krb.TicketFlags.transited_policy_checked=12,krb.TicketFlags.ok_as_delegate=13,krb.TransitedEncoding=new asn1.SEQUENCE([{id:"trType",type:krb.Int32.tagged(asn1.tag(0))},{id:"contents",type:asn1.OCTET_STRING.tagged(asn1.tag(1))}]),krb.EncTicketPart=new asn1.SEQUENCE([{id:"flags",type:krb.TicketFlags.tagged(asn1.tag(0))},{id:"key",type:krb.EncryptionKey.tagged(asn1.tag(1))},{id:"crealm",type:krb.Realm.tagged(asn1.tag(2))},{id:"cname",type:krb.PrincipalName.tagged(asn1.tag(3))},{id:"transited",type:krb.TransitedEncoding.tagged(asn1.tag(4))},{id:"authtime",type:krb.KerberosTime.tagged(asn1.tag(5))},{id:"starttime",type:krb.KerberosTime.tagged(asn1.tag(6)),optional:!0},{id:"endtime",type:krb.KerberosTime.tagged(asn1.tag(7))},{id:"renewTill",type:krb.KerberosTime.tagged(asn1.tag(8)),optional:!0},{id:"caddr",type:krb.HostAddresses.tagged(asn1.tag(9)),optional:!0},{id:"authorizationData",type:krb.AuthorizationData.tagged(asn1.tag(10)),optional:!0}]).tagged(asn1.tag(3,asn1.TAG_APPLICATION)),krb.KRB_ERROR=new asn1.SEQUENCE([{id:"pvno",type:asn1.INTEGER.valueConstrained(5).tagged(asn1.tag(0))},{id:"msgType",type:asn1.INTEGER.valueConstrained(30).tagged(asn1.tag(1))},{id:"ctime",type:krb.KerberosTime.tagged(asn1.tag(2)),optional:!0},{id:"cusec",type:krb.Microseconds.tagged(asn1.tag(3)),optional:!0},{id:"stime",type:krb.KerberosTime.tagged(asn1.tag(4))},{id:"susec",type:krb.Microseconds.tagged(asn1.tag(5))},{id:"errorCode",type:krb.Int32.tagged(asn1.tag(6))},{id:"crealm",type:krb.Realm.tagged(asn1.tag(7)),optional:!0},{id:"cname",type:krb.PrincipalName.tagged(asn1.tag(8)),optional:!0},{id:"realm",type:krb.Realm.tagged(asn1.tag(9))},{id:"sname",type:krb.PrincipalName.tagged(asn1.tag(10))},{id:"eText",type:krb.KerberosString.tagged(asn1.tag(11)),optional:!0},{id:"eData",type:asn1.OCTET_STRING.tagged(asn1.tag(12)),optional:!0}]).tagged(asn1.tag(30,asn1.TAG_APPLICATION)),krb.METHOD_DATA=new asn1.SEQUENCE_OF(krb.PA_DATA),krb.TYPED_DATA=new asn1.SEQUENCE([{id:"dataType",type:krb.Int32.tagged(asn1.tag(0))},{id:"dataValue",type:asn1.OCTET_STRING.tagged(asn1.tag(1)),optional:!0}]),krb.KDCOptions=krb.KerberosFlags.subtype(),krb.KDCOptions.reserved=0,krb.KDCOptions.forwardable=1,krb.KDCOptions.forwarded=2,krb.KDCOptions.proxiable=3,krb.KDCOptions.proxy=4,krb.KDCOptions.allow_postdate=5,krb.KDCOptions.postdated=6,krb.KDCOptions.renewable=8,krb.KDCOptions.opt_hardware_auth=11,krb.KDCOptions.disable_transited_check=26,krb.KDCOptions.renewable_ok=27,krb.KDCOptions.enc_tkt_in_skey=28,krb.KDCOptions.renew=30,krb.KDCOptions.validate=31,krb.KDC_REQ_BODY=new asn1.SEQUENCE([{id:"kdcOptions",type:krb.KDCOptions.tagged(asn1.tag(0))},{id:"principalName",type:krb.PrincipalName.tagged(asn1.tag(1)),optional:!0},{id:"realm",type:krb.Realm.tagged(asn1.tag(2))},{id:"sname",type:krb.PrincipalName.tagged(asn1.tag(3)),optional:!0},{id:"from",type:krb.KerberosTime.tagged(asn1.tag(4)),optional:!0},{id:"till",type:krb.KerberosTime.tagged(asn1.tag(5))},{id:"rtime",type:krb.KerberosTime.tagged(asn1.tag(6)),optional:!0},{id:"nonce",type:krb.UInt32.tagged(asn1.tag(7))},{id:"etype",type:new asn1.SEQUENCE_OF(krb.Int32).tagged(asn1.tag(8))},{id:"addresses",type:krb.HostAddresses.tagged(asn1.tag(9)),optional:!0},{id:"encAuthorizationData",type:krb.EncryptedData.tagged(asn1.tag(10)),optional:!0},{id:"additionalTickets",type:new asn1.SEQUENCE_OF(krb.Ticket).tagged(asn1.tag(10)),optional:!0}]),krb.KDC_REQ=new asn1.SEQUENCE([{id:"pvno",type:asn1.INTEGER.valueConstrained(5).tagged(asn1.tag(1))},{id:"msgType",type:asn1.INTEGER.valueConstrained(10,12).tagged(asn1.tag(2))},{id:"padata",type:new asn1.SEQUENCE_OF(krb.PA_DATA).tagged(asn1.tag(3)),optional:!0},{id:"reqBody",type:krb.KDC_REQ_BODY.tagged(asn1.tag(4))}]),krb.AS_REQ=krb.KDC_REQ.tagged(asn1.tag(10,asn1.TAG_APPLICATION)),krb.TGS_REQ=krb.KDC_REQ.tagged(asn1.tag(12,asn1.TAG_APPLICATION)),krb.KDC_REP=new asn1.SEQUENCE([{id:"pvno",type:asn1.INTEGER.valueConstrained(5).tagged(asn1.tag(0))},{id:"msgType",type:asn1.INTEGER.valueConstrained(11,13).tagged(asn1.tag(1))},{id:"padata",type:new asn1.SEQUENCE_OF(krb.PA_DATA).tagged(asn1.tag(2)),optional:!0},{id:"crealm",type:krb.Realm.tagged(asn1.tag(3))},{id:"cname",type:krb.PrincipalName.tagged(asn1.tag(4))},{id:"ticket",type:krb.Ticket.tagged(asn1.tag(5))},{id:"encPart",type:krb.EncryptedData.tagged(asn1.tag(6))}]),krb.AS_REP=krb.KDC_REP.tagged(asn1.tag(11,asn1.TAG_APPLICATION)),krb.TGS_REP=krb.KDC_REP.tagged(asn1.tag(13,asn1.TAG_APPLICATION)),krb.AS_REP_OR_ERROR=new asn1.CHOICE([krb.AS_REP,krb.KRB_ERROR]),krb.TGS_REP_OR_ERROR=new asn1.CHOICE([krb.TGS_REP,krb.KRB_ERROR]),krb.LastReq=new asn1.SEQUENCE_OF(new asn1.SEQUENCE([{id:"lrType",type:krb.Int32.tagged(asn1.tag(0))},{id:"lrValue",type:krb.KerberosTime.tagged(asn1.tag(1))}])),krb.EncKDCRepPart=new asn1.SEQUENCE([{id:"key",type:krb.EncryptionKey.tagged(asn1.tag(0))},{id:"lastReq",type:krb.LastReq.tagged(asn1.tag(1))},{id:"nonce",type:krb.UInt32.tagged(asn1.tag(2))},{id:"keyExpiration",type:krb.KerberosTime.tagged(asn1.tag(3)),optional:!0},{id:"flags",type:krb.TicketFlags.tagged(asn1.tag(4))},{id:"authtime",type:krb.KerberosTime.tagged(asn1.tag(5))},{id:"starttime",type:krb.KerberosTime.tagged(asn1.tag(6)),optional:!0},{id:"endtime",type:krb.KerberosTime.tagged(asn1.tag(7))},{id:"renewTill",type:krb.KerberosTime.tagged(asn1.tag(8)),optional:!0},{id:"srealm",type:krb.Realm.tagged(asn1.tag(9))},{id:"sname",type:krb.PrincipalName.tagged(asn1.tag(10))},{id:"caddr",type:krb.HostAddresses.tagged(asn1.tag(11)),optional:!0}]),krb.EncASRepPart=krb.EncKDCRepPart.tagged(asn1.tag(25,asn1.TAG_APPLICATION)),krb.EncTGSRepPart=krb.EncKDCRepPart.tagged(asn1.tag(26,asn1.TAG_APPLICATION)),krb.EncASorTGSRepPart=new asn1.CHOICE([krb.EncASRepPart,krb.EncTGSRepPart]),krb.APOptions=krb.KerberosFlags.subtype(),krb.APOptions.use_session_key=1,krb.APOptions.mutual_required=2,krb.AP_REQ=new asn1.SEQUENCE([{id:"pvno",type:asn1.INTEGER.valueConstrained(5).tagged(asn1.tag(0))},{id:"msgType",type:asn1.INTEGER.valueConstrained(14).tagged(asn1.tag(1))},{id:"apOptions",type:krb.APOptions.tagged(asn1.tag(2))},{id:"ticket",type:krb.Ticket.tagged(asn1.tag(3))},{id:"authenticator",type:krb.EncryptedData.tagged(asn1.tag(4))}]).tagged(asn1.tag(14,asn1.TAG_APPLICATION)),krb.Authenticator=new asn1.SEQUENCE([{id:"authenticatorVno",type:asn1.INTEGER.valueConstrained(5).tagged(asn1.tag(0))},{id:"crealm",type:krb.Realm.tagged(asn1.tag(1))},{id:"cname",type:krb.PrincipalName.tagged(asn1.tag(2))},{id:"cksum",type:krb.Checksum.tagged(asn1.tag(3)),optional:!0},{id:"cusec",type:krb.Microseconds.tagged(asn1.tag(4))},{id:"ctime",type:krb.KerberosTime.tagged(asn1.tag(5))},{id:"subkey",type:krb.EncryptionKey.tagged(asn1.tag(6)),optional:!0},{id:"seqNumber",type:krb.UInt32.tagged(asn1.tag(7)),optional:!0},{id:"authorizationData",type:krb.AuthorizationData.tagged(asn1.tag(8)),optional:!0}]).tagged(asn1.tag(2,asn1.TAG_APPLICATION)),krb.AP_REP=new asn1.SEQUENCE([{id:"pvno",type:asn1.INTEGER.valueConstrained(5).tagged(asn1.tag(0))},{id:"msgType",type:asn1.INTEGER.valueConstrained(15).tagged(asn1.tag(1))},{id:"encPart",type:krb.EncryptedData.tagged(asn1.tag(2))}]).tagged(asn1.tag(15,asn1.TAG_APPLICATION)),krb.EncAPRepPart=new asn1.SEQUENCE([{id:"ctime",type:krb.KerberosTime.tagged(asn1.tag(0))},{id:"cusec",type:krb.Microseconds.tagged(asn1.tag(1))},{id:"subkey",type:krb.EncryptionKey.tagged(asn1.tag(2)),optional:!0},{id:"seqNumber",type:krb.UInt32.tagged(asn1.tag(3)),optional:!0}]).tagged(asn1.tag(27,asn1.TAG_APPLICATION)),krb.EtypeList=new asn1.SEQUENCE_OF(krb.Int32),krb.KU_AS_REQ_PA_ENC_TIMESTAMP=1,krb.KU_KDC_REP_TICKET=2,krb.KU_AS_REQ_ENC_PART=3,krb.KU_TGS_REQ_BODY_AUTH_DATA=4,krb.KU_TGS_REQ_BODY_AUTH_DATA_SUBKEY=5,krb.KU_TGS_REQ_PA_TGS_REQ_CKSUM=6,krb.KU_TGS_REQ_PA_TGS_REQ=7,krb.KU_TGS_REQ_ENC_PART=8,krb.KU_TGS_REQ_ENC_PART_SUBKEY=9,krb.KU_AP_REQ_AUTHENTICATOR_CKSUM=10,krb.KU_AP_REQ_AUTHENTICATOR=11,krb.KU_AP_REP_ENC_PART=12,krb.KU_KRB_PRIV_ENC_PART=13,krb.KU_KRB_CRED_ENC_PART=14,krb.KU_KRB_SAFE_CKSUM=15,krb.KU_AD_KDC_ISSUED_CKSUM=19,krb.KU_GENERIC_ENC=1024,krb.KU_GENERIC_CKSUM=1025,krb.PA_TGS_REQ=1,krb.PA_ENC_TIMESTAMP=2,krb.PA_PW_SALT=3,krb.PA_ENC_UNIX_TIME=5,krb.PA_SANDIA_SECUREID=6,krb.PA_SESAME=7,krb.PA_OSF_DCE=8,krb.PA_CYBERSAFE_SECUREID=9,krb.PA_AFS3_SALT=10,krb.PA_ETYPE_INFO=11,krb.PA_SAM_CHALLENGE=12,krb.PA_SAM_RESPONSE=13,krb.PA_PK_AS_REQ_OLD=14,krb.PA_PK_AS_REP_OLD=15,krb.PA_PK_AS_REQ=16,krb.PA_PK_AS_REP=17,krb.PA_ETYPE_INFO2=19,krb.PA_USE_SPECIFIED_KVNO=20,krb.PA_SAM_REDIRECT=21,krb.PA_GET_FROM_TYPED_DATA=22,krb.TD_PADATA=22,krb.PA_SAM_ETYPE_INFO=23,krb.PA_ALT_PRINC=24,krb.PA_SAM_CHALLENGE2=30,krb.PA_SAM_RESPONSE2=31,krb.PA_EXTRA_TGT=41,krb.TD_PKINIT_CMS_CERTIFICATES=101,krb.TD_KRB_PRINCIPAL=102,krb.TD_KRB_REALM=103,krb.TD_TRUSTED_CERTIFIERS=104,krb.TD_CERTIFICATE_INDEX=105,krb.TD_APP_DEFINED_ERROR=106,krb.TD_REQ_NONCE=107,krb.TD_REQ_SEQ=108,krb.PA_PAC_REQUEST=128,krb.ADDRESS_IPV4=2,krb.ADDRESS_DIRECTIONAL=3,krb.ADDRESS_CHAOSNET=5,krb.ADDRESS_XNS=6,krb.ADDRESS_ISO=7,krb.ADDRESS_DECNET_PHASE_IV=12,krb.ADDRESS_APPLETALK_UDP=16,krb.ADDRESS_NETBIOS=20,krb.ADDRESS_IPV6=24,krb.AD_IF_RELEVANT_TYPE=1,krb.AD_INTENDED_FOR_SERVER=2,krb.AD_INTENDED_FOR_APPLICATION_CLASS=3,krb.AD_KDC_ISSUED=4,krb.AD_AND_OR=5,krb.AD_MANDATORY_TICKET_EXTENSIONS=6,krb.AD_IN_TICKET_EXTENSIONS=7,krb.AD_MANDATORY_FOR_KDC=8,krb.OSF_DCE=64,krb.SESAME=65,krb.AD_OSF_DCE_PKI_CERTID=66,krb.AD_WIN2K_PAC=128,krb.AD_ETYPE_NEGOTIATION=129,krb.DOMAIN_X500_COMPRESS=1,krb.pvno=5,krb.KRB_MT_AS_REQ=10,krb.KRB_MT_AS_REP=11,krb.KRB_MT_TGS_REQ=12,krb.KRB_MT_TGS_REP=13,krb.KRB_MT_AP_REQ=14,krb.KRB_MT_AP_REP=15,krb.KRB_MT_SAFE=20,krb.KRB_MT_PRIV=21,krb.KRB_MT_CRED=22,krb.KRB_MT_ERROR=30,krb.KRB_NT_UNKNOWN=0,krb.KRB_NT_PRINCIPAL=1,krb.KRB_NT_SRV_INST=2,krb.KRB_NT_SRV_HST=3,krb.KRB_NT_SRV_XHST=4,krb.KRB_NT_UID=5,krb.KRB_NT_X500_PRINCIPAL=6,krb.KRB_NT_SMTP_NAME=7,krb.KRB_NT_ENTERPRISE=10,krb.KDC_ERR_NONE=0,krb.KDC_ERR_NAME_EXP=1,krb.KDC_ERR_SERVICE_EXP=2,krb.KDC_ERR_BAD_PVNO=3,krb.KDC_ERR_C_OLD_MAST_KVNO=4,krb.KDC_ERR_S_OLD_MAST_KVNO=5,krb.KDC_ERR_C_PRINCIPAL_UNKNOWN=6,krb.KDC_ERR_S_PRINCIPAL_UNKNOWN=7,krb.KDC_ERR_PRINCIPAL_NOT_UNIQUE=8,krb.KDC_ERR_NULL_KEY=9,krb.KDC_ERR_CANNOT_POSTDATE=10,krb.KDC_ERR_NEVER_VALID=11,krb.KDC_ERR_POLICY=12,krb.KDC_ERR_BADOPTION=13,krb.KDC_ERR_ETYPE_NOSUPP=14,krb.KDC_ERR_SUMTYPE_NOSUPP=15,krb.KDC_ERR_PADATA_TYPE_NOSUPP=16,krb.KDC_ERR_TRTYPE_NOSUPP=17,krb.KDC_ERR_CLIENT_REVOKED=18,krb.KDC_ERR_SERVICE_REVOKED=19,krb.KDC_ERR_TGT_REVOKED=20,krb.KDC_ERR_CLIENT_NOTYET=21,krb.KDC_ERR_SERVICE_NOTYET=22,krb.KDC_ERR_KEY_EXPIRED=23,krb.KDC_ERR_PREAUTH_FAILED=24,krb.KDC_ERR_PREAUTH_REQUIRED=25,krb.KDC_ERR_SERVER_NOMATCH=26,krb.KDC_ERR_MUST_USE_USER2USER=27,krb.KDC_ERR_PATH_NOT_ACCEPTED=28,krb.KDC_ERR_SVC_UNAVAILABLE=29,krb.KRB_AP_ERR_BAD_INTEGRITY=31,krb.KRB_AP_ERR_TKT_EXPIRED=32,krb.KRB_AP_ERR_TKT_NYV=33,krb.KRB_AP_ERR_REPEAT=34,krb.KRB_AP_ERR_NOT_US=35,krb.KRB_AP_ERR_BADMATCH=36,krb.KRB_AP_ERR_SKEW=37,krb.KRB_AP_ERR_BADADDR=38,krb.KRB_AP_ERR_BADVERSION=39,krb.KRB_AP_ERR_MSG_TYPE=40,krb.KRB_AP_ERR_MODIFIED=41,krb.KRB_AP_ERR_BADORDER=42,krb.KRB_AP_ERR_BADKEYVER=44,krb.KRB_AP_ERR_NOKEY=45,krb.KRB_AP_ERR_MUT_FAIL=46,krb.KRB_AP_ERR_BADDIRECTION=47,krb.KRB_AP_ERR_METHOD=48,krb.KRB_AP_ERR_BADSEQ=49,krb.KRB_AP_ERR_INAPP_CKSUM=50,krb.KRB_AP_PATH_NOT_ACCEPTED=51,krb.KRB_ERR_RESPONSE_TOO_BIG=52,krb.KRB_ERR_GENERIC=60,krb.KRB_ERR_FIELD_TOOLONG=61,krb.KDC_ERROR_CLIENT_NOT_TRUSTED=62,krb.KDC_ERROR_KDC_NOT_TRUSTED=63,krb.KDC_ERROR_INVALID_SIG=64,krb.KDC_ERR_KEY_TOO_WEAK=65,krb.KDC_ERR_CERTIFICATE_MISMATCH=66,krb.KRB_AP_ERR_NO_TGT=67,krb.KDC_ERR_WRONG_REALM=68,krb.KRB_AP_ERR_USER_TO_USER_REQUIRED=69,krb.KDC_ERR_CANT_VERIFY_CERTIFICATE=70,krb.KDC_ERR_INVALID_CERTIFICATE=71,krb.KDC_ERR_REVOKED_CERTIFICATE=72,krb.KDC_ERR_REVOCATION_STATUS_UNKNOWN=73,krb.KDC_ERR_REVOCATION_STATUS_UNAVAILABLE=74,krb.KDC_ERR_CLIENT_NAME_MISMATCH=75,krb.KDC_ERR_KDC_NAME_MISMATCH=76,"object"==typeof exports&&(module.exports=krb);
var kcrypto=function(){"use strict";function a(a){for(a[a.length-1]>>>=0;a.length<4;)a.push(0)}function b(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]}function c(a,b){var c;for(a>b&&(c=a,a=b,b=c);0!=a;)c=b%a,b=a,a=c;return b}function d(a,b){if(sjcl.bitArray.bitLength(a)!=sjcl.bitArray.bitLength(b))throw"Lengths must match";if(0==a.length)return[];var c=sjcl.bitArray.getPartial(a[a.length-1]),d=0,e=a.slice(0);d+=(e[e.length-1]>>>0)+(b[e.length-1]>>>0),e[e.length-1]=sjcl.bitArray.partial(c,d>>>0,1),d=d>4294967296?1:0;for(var f=e.length-2;f>=0;f--)d+=(e[f]>>>0)+(b[f]>>>0),e[f]=d>>>0,d=d>=4294967296?1:0;if(d>0&&(d=(1<<32-c)+(e[e.length-1]>>>0),e[e.length-1]=sjcl.bitArray.partial(c,d>>>0,1),d>=4294967296))for(var f=e.length-2;f>=0&&(d=1+(e[f]>>>0),e[f]=d>>>0,!(4294967296>d));f--);return e}function e(a,b){for(var e=arrayutils.toSJCL(b),f=sjcl.bitArray.bitLength(e),g=a/c(a,f),h=13%f,i=arrayutils.toSJCL(new Uint8Array(a/8)),j=[],k=0,l=e,m=0;g>m;m++)for(j=sjcl.bitArray.concat(j,l),k+=f,l=sjcl.bitArray.concat(sjcl.bitArray.bitSlice(l,f-h),sjcl.bitArray.bitSlice(l,0,f-h));k>=a;)i=d(i,sjcl.bitArray.bitSlice(j,0,a)),j=sjcl.bitArray.bitSlice(j,a),k-=a;if(0!=sjcl.bitArray.bitLength(j))throw"Bits left over!";return arrayutils.fromSJCL(i)}function f(a){function b(b,c){var d=b.encrypt(arrayutils.toSJCL(c));return d=sjcl.bitArray.bitSlice(d,0,8*a.hmacOutputSize),arrayutils.fromSJCL(d)}if(0!=a.keyGenerationSeedLength%8)throw"Bad simple profile";var c={};c.enctype=a.enctype;var d=new Uint8Array(a.cipherBlockSize);c.initialCipherState=function(){return d},c.keyGenerationSeedLength=a.keyGenerationSeedLength,c.randomToKey=function(b){return a.randomToKey(b)},c.stringToKey=function(b,c,d){return a.stringToKey(b,c,d,this)},c.encrypt=function(c,d,e){e=arrayutils.asUint8Array(e);var f=arrayutils.fromSJCL(sjcl.bitArray.clamp(sjcl.random.randomWords(Math.ceil(a.cipherBlockSize/4)),8*a.cipherBlockSize)),g=(a.cipherBlockSize+e.length)%a.messageBlockSize;g=a.messageBlockSize-g,g==a.messageBlockSize&&(g=0);var h=new Uint8Array(f.length+e.length+g);h.set(f),h.set(e,f.length);var i=a.encrypt(c.E,d,h,this),j=i[0],k=i[1],l=b(c.I,h),m=new Uint8Array(k.length+l.length);return m.set(k),m.set(l,k.length),[j,m]},c.decrypt=function(c,d,e){e=arrayutils.asUint8Array(e);var f=e.subarray(0,e.length-a.hmacOutputSize),g=e.subarray(e.length-a.hmacOutputSize),h=a.decrypt(c.E,d,f,this),i=h[0],j=h[1];if(!arrayutils.equals(g,b(c.I,j)))throw new k.DecryptionError("Checksum mismatch!");return j=j.subarray(a.cipherBlockSize),[i,j]},c.DK=function(b,c){c.length<a.cipherBlockSize&&(c=e(8*a.cipherBlockSize,c));for(var f=a.keyGenerationSeedLength/8,g=new Uint8Array(f),h=0,i=c;f>h;)i=a.encrypt(b,d,i)[1],g.set(i.subarray(0,Math.min(i.byteLength,f-h)),h),h+=i.byteLength;return this.randomToKey(g)},c.deriveKey=function(b,c){var d=new Uint8Array(5);new DataView(d.buffer).setUint32(0,c),d[4]=153;var e=this.DK(b,d);d[4]=170;var f=this.DK(b,d);d[4]=85;var g=this.DK(b,d);return{C:new sjcl.misc.hmac(arrayutils.toSJCL(e),a.unkeyedHash),E:f,I:new sjcl.misc.hmac(arrayutils.toSJCL(g),a.unkeyedHash)}},c.paddingBytes=function(b){return b%=a.messageBlockSize,0!=b?a.messageBlockSize-b:0};var f={};return f.sumtype=a.sumtype,f.checksumBytes=a.hmacOutputSize,f.getMIC=function(a,c){return b(a.C,c)},f.verifyMIC=function(a,b,c){return arrayutils.equals(c,this.getMIC(a,b))},c.checksum=f,[c,f]}function g(a,b,c,d){function e(a){sjcl.misc.hmac.call(this,a,sjcl.hash.sha1)}if(void 0==c&&(c=new Uint8Array([0,0,16,0])),4!=c.length)throw new k.InvalidParameters("Bad string-to-key parameter");var f=new DataView(c.buffer,c.byteOffset,c.byteLength).getUint32(0);0==f&&(f=4294967296),e.prototype=sjcl.misc.hmac.prototype;var g=this.randomToKey(arrayutils.fromSJCL(sjcl.misc.pbkdf2(sjcl.codec.utf8String.toBits(a),arrayutils.toSJCL(b),f,this.keyGenerationSeedLength,e)));return d.DK(g,arrayutils.fromByteString("kerberos"))}function h(b,c,d){var e=new sjcl.cipher.aes(arrayutils.toSJCL(b)),f=arrayutils.toSJCL(c),g=arrayutils.toSJCL(d);if(g.length<=4){a(g);var h=arrayutils.fromSJCL(e.encrypt(g));return[h,h]}var i=l.encrypt(e,g,f),j=i.length;0!=j%4&&(j+=4-j%4);var k=i.slice(j-8,j-4);return[arrayutils.fromSJCL(k),arrayutils.fromSJCL(i)]}function i(a,b,c){var d=new sjcl.cipher.aes(arrayutils.toSJCL(a)),e=arrayutils.toSJCL(b),f=arrayutils.toSJCL(c);if(!(f.length<=4)){var g=l.decrypt(d,f,e),h=f.length;0!=h%4&&(h+=4-h%4);var i=f.slice(h-8,h-4);return[arrayutils.fromSJCL(i),arrayutils.fromSJCL(g)]}if(128!=sjcl.bitArray.bitLength(f))throw new k.DecryptionError("Bad length");try{return[c,arrayutils.fromSJCL(d.decrypt(f))]}catch(j){if(j instanceof sjcl.exception.corrupt)throw new k.DecryptionError(j.message);throw j}}function j(a){return new Uint8Array(arrayutils.asUint8Array(a))}var k={};k.DecryptionError=function(a){this.message=a},k.DecryptionError.prototype.toString=function(){return"DecryptionError: "+this.message},k.InvalidParameters=function(a){this.message=a},k.InvalidParameters.prototype.toString=function(){return"InvalidParameters: "+this.message},k.DECRYPT=0,k.ENCRYPT=1,k.enctype={},k.enctype.des_cbc_crc=1,k.enctype.des_cbc_md4=2,k.enctype.des_cbc_md5=3,k.enctype.des3_cbc_md5=5,k.enctype.des3_cbc_sha1=7,k.enctype.dsaWithSHA1_CmsOID=9,k.enctype.md5WithRSAEncryption_CmsOID=10,k.enctype.sha1WithRSAEncryption_CmsOID=11,k.enctype.rc2CBC_EnvOID=12,k.enctype.rsaEncryption_EnvOID=13,k.enctype.rsaES_OAEP_ENV_OID=14,k.enctype.des_ede3_cbc_Env_OID=15,k.enctype.des3_cbc_sha1_kd=16,k.enctype.aes128_cts_hmac_sha1_96=17,k.enctype.aes256_cts_hmac_sha1_96=18,k.enctype.rc4_hmac=23,k.enctype.rc4_hmac_exp=24,k.enctype.subkey_keymaterial=65,k.sumtype={},k.sumtype.CRC32=1,k.sumtype.rsa_md4=2,k.sumtype.rsa_md4_des=3,k.sumtype.des_mac=4,k.sumtype.des_mac_k=5,k.sumtype.rsa_md4_des_k=6,k.sumtype.rsa_md5=7,k.sumtype.rsa_md5_des=8,k.sumtype.rsa_md5_des3=9,k.sumtype.sha1=10,k.sumtype.hmac_sha1_des3_kd=12,k.sumtype.hmac_sha1_des3=13,k.sumtype.sha1_2=14,k.sumtype.hmac_sha1_96_aes128=15,k.sumtype.hmac_sha1_96_aes256=16;var l={encrypt:function(c,d,e,f){if(f&&f.length)throw new sjcl.exception.invalid("cbc can't authenticate data");if(128!==sjcl.bitArray.bitLength(e))throw new sjcl.exception.invalid("cbc iv must be 128 bits");var g,h=sjcl.bitArray,i=h.bitLength(d),j=[];if(128>=i)throw new sjcl.exception.invalid("plaintext must be more than 128 bits");for(g=0;g+8<d.length;g+=4)e=c.encrypt(b(e,d.slice(g,g+4))),j.splice(g,0,e[0],e[1],e[2],e[3]);e=c.encrypt(b(e,d.slice(g,g+4)));var k=d.slice(g+4,g+8),l=h.bitLength(k);a(k);var m=c.encrypt(b(e,k));j.push(m[0],m[1],m[2],m[3]);var n=h.clamp(e,l);for(g=0;g<n.length;g++)j.push(n[g]);return j},decrypt:function(c,d,e,f){if(f&&f.length)throw new sjcl.exception.invalid("cbc can't authenticate data");if(128!==sjcl.bitArray.bitLength(e))throw new sjcl.exception.invalid("cbc iv must be 128 bits");var g=sjcl.bitArray.bitLength(d);if(128>=g)throw new sjcl.exception.corrupt("cbc-cts ciphertext must be at least two blocks");var h,i,j,k=sjcl.bitArray,l=[];for(h=0;h+8<d.length;h+=4)i=d.slice(h,h+4),j=b(e,c.decrypt(i)),l.splice(h,0,j[0],j[1],j[2],j[3]),e=i;var m=c.decrypt(d.slice(h,h+4)),n=d.slice(h+4,h+8),o=k.bitLength(n);a(n);var p=b(n,m),q=k.clamp(p,o),r=q.slice(0);a(r);var s=b(n,b(r,p)),t=b(e,c.decrypt(s));for(l.push(t[0],t[1],t[2],t[3]),h=0;h<q.length;h++)l.push(q[h]);return l}};k.nFold=e,k.aesCtsEncrypt=h,k.aesCtsDecrypt=i;var m=f({enctype:k.enctype.aes128_cts_hmac_sha1_96,sumtype:k.sumtype.hmac_sha1_96_aes128,stringToKey:g,keyGenerationSeedLength:128,randomToKey:j,unkeyedHash:sjcl.hash.sha1,hmacOutputSize:12,messageBlockSize:1,encrypt:h,decrypt:i,cipherBlockSize:16});k.Aes128CtsHmacShaOne96=m[0],k.ShaOne96Aes128Checksum=m[1];var n=f({enctype:k.enctype.aes256_cts_hmac_sha1_96,sumtype:k.sumtype.hmac_sha1_96_aes256,stringToKey:g,keyGenerationSeedLength:256,randomToKey:j,unkeyedHash:sjcl.hash.sha1,hmacOutputSize:12,messageBlockSize:1,encrypt:h,decrypt:i,cipherBlockSize:16});return k.Aes256CtsHmacShaOne96=n[0],k.ShaOne96Aes256Checksum=n[1],k.encProfiles={},k.encProfiles[k.Aes128CtsHmacShaOne96.enctype]=k.Aes128CtsHmacShaOne96,k.encProfiles[k.Aes256CtsHmacShaOne96.enctype]=k.Aes256CtsHmacShaOne96,k.sumProfiles={},k.sumProfiles[k.ShaOne96Aes128Checksum.sumtype]=k.ShaOne96Aes128Checksum,k.sumProfiles[k.ShaOne96Aes256Checksum.sumtype]=k.ShaOne96Aes256Checksum,k}();!function(){"use strict";function a(a){return a.replace("\\","\\\\").replace("\0","\\0").replace("\n","\\n").replace("	","\\t").replace("\b","\\b").replace("/","\\/").replace("@","\\@")}krb.realm="ATHENA.MIT.EDU",krb.supportedEnctypes=[kcrypto.enctype.aes256_cts_hmac_sha1_96,kcrypto.enctype.aes128_cts_hmac_sha1_96],krb.Principal=function(a,b){this.principalName=a,this.realm=b},krb.Principal.prototype.nameToString=function(){for(var b=[],c=0;c<this.principalName.nameString.length;c++)b.push(a(this.principalName.nameString[c]));return b.join("/")},krb.Principal.prototype.toString=function(){return this.nameToString()+"@"+a(this.realm)},krb.Principal.prototype.toStringShort=function(){return this.realm==krb.realm?this.nameToString():this.toString()},krb.Principal.fromString=function(a){for(var b=[],c="",d=!1,e=0;e<a.length;e++)if("\\"==a[e]){if(e++,e>=a.length)throw"Malformed principal";switch(a[e]){case"n":c+="\n";break;case"t":c+="	";break;case"b":c+="\b";break;case"0":c+="\0";break;default:c+=a[e]}}else if("/"==a[e]){if(d)throw"Malformed principal";b.push(c),c=""}else if("@"==a[e]){if(d)throw"Malformed principal";b.push(c),c="",d=!0}else c+=a[e];return d||(b.push(c),c=krb.realm),new krb.Principal({nameType:krb.KRB_NT_PRINCIPAL,nameString:b},c)},krb.Key=function(a,b){if(this.keytype=a,this.keyvalue=b,this.profile=kcrypto.encProfiles[a],void 0===this.profile)throw new Err(Err.Context.KEY,0,"Unsupported enctype "+this.keytype)},krb.Key.makeRandomKey=function(a){var b=kcrypto.encProfiles[a];if(void 0===b)throw new Err(Err.Context.KEY,0,"Unsupported enctype "+a);var c=sjcl.random.randomWords(b.keyGenerationSeedLength+31>>>5),d=arrayutils.fromSJCL(c).subarray(0,b.keyGenerationSeedLength+7>>>3);return new krb.Key(a,b.randomToKey(d))},krb.Key.prototype.decrypt=function(a,b){if(b.etype!=this.keytype)throw new Err(Err.Context.KEY,1,"Key types do not match");var c=this.profile.deriveKey(this.keyvalue,a);return this.profile.decrypt(c,this.profile.initialCipherState(c,kcrypto.DECRYPT),b.cipher)[1]},krb.Key.prototype.decryptAs=function(a,b,c){return a.decodeDERPrefix(this.decrypt(b,c))[0]},krb.Key.prototype.encrypt=function(a,b){var c=this.profile.deriveKey(this.keyvalue,a);return{etype:this.keytype,cipher:this.profile.encrypt(c,this.profile.initialCipherState(c,kcrypto.ENCRYPT),b)[1]}},krb.Key.prototype.encryptAs=function(a,b,c){return this.encrypt(b,a.encodeDER(c))},krb.Key.prototype.checksum=function(a,b){var c=this.profile.deriveKey(this.keyvalue,a);return{cksumtype:this.profile.checksum.sumtype,checksum:this.profile.checksum.getMIC(c,b)}},krb.Key.prototype.toDict=function(){return{keytype:this.keytype,keyvalue:arrayutils.toBase64(this.keyvalue)}},krb.Key.fromDict=function(a){return new krb.Key(a.keytype,arrayutils.fromBase64(a.keyvalue))},krb.Key.fromPassword=function(a,b,c,d){var e=kcrypto.encProfiles[a];if(void 0===e)throw new Err(Err.Context.KEY,2,"Unsupported enctype "+a);return new krb.Key(a,e.stringToKey(b,c,d))},krb.Session=function(a,b){this.client=new krb.Principal(a.cname,a.crealm),this.ticket=a.ticket,this.key=new krb.Key(b.key.keytype,b.key.keyvalue),this.flags=b.flags,this.authtime=b.authtime,this.starttime=b.starttime,this.endtime=b.endtime,this.renewTill=b.renewTill,this.service=new krb.Principal(b.sname,b.srealm),this.caddr=b.caddr},krb.Session.fromDict=function(a){function b(a){return null==a?void 0:new Date(a)}return new krb.Session({crealm:a.crealm,cname:a.cname,ticket:{tktVno:a.ticket.tktVno,realm:a.ticket.realm,sname:a.ticket.sname,encPart:{kvno:a.ticket.encPart.kvno,etype:a.ticket.encPart.etype,cipher:arrayutils.fromBase64(a.ticket.encPart.cipher)}}},{key:{keytype:a.key.keytype,keyvalue:arrayutils.fromBase64(a.key.keyvalue)},lastReq:a.lastReq,nonce:a.nonce,keyExpiration:a.keyExpiration,flags:a.flags,authtime:new Date(a.authtime),starttime:b(a.starttime),endtime:new Date(a.endtime),renewTill:b(a.renewTill),srealm:a.srealm,sname:a.sname,caddr:a.caddr})},krb.Session.prototype.toDict=function(){function a(a){return null==a?void 0:a.getTime()}return{crealm:this.client.realm,cname:this.client.principalName,ticket:{tktVno:this.ticket.tktVno,realm:this.ticket.realm,sname:this.ticket.sname,encPart:{kvno:this.ticket.encPart.kvno,etype:this.ticket.encPart.etype,cipher:arrayutils.toBase64(this.ticket.encPart.cipher)}},key:this.key.toDict(),flags:this.flags,authtime:this.authtime.getTime(),starttime:a(this.starttime),endtime:this.endtime.getTime(),renewTill:a(this.renewTill),srealm:this.service.realm,sname:this.service.principalName,caddr:this.caddr}},krb.Session.prototype.timeRemaining=function(){return this.endtime.getTime()-(new Date).getTime()},krb.Session.prototype.isExpired=function(){return this.timeRemaining()<0},krb.Session.prototype.makeAPReq=function(a,b,c){c=c||{};var d={};d.pvno=krb.pvno,d.msgType=krb.KRB_MT_AP_REQ,d.apOptions=c.apOptions||krb.APOptions.make(),d.ticket=this.ticket;var e={};e.authenticatorVno=krb.pvno,e.crealm=this.client.realm,e.cname=this.client.principalName,void 0!==b&&(e.cksum=b),e.ctime=new Date,e.cusec=1e3*e.ctime.getUTCMilliseconds(),e.ctime.setUTCMilliseconds(0),sjcl.random.addEntropy(arrayutils.toSJCL(this.key.keyvalue),8*this.key.keyvalue.length,"key");var f;c.useSubkey&&(f=krb.Key.makeRandomKey(this.key.keytype),e.subkey={keytype:f.keytype,keyvalue:f.keyvalue});var g;if(c.useSeqNumber&&(g=67108863&sjcl.random.randomWords(1)[0],e.seqNumber=g),d.apOptions[krb.APOptions.mutual_required]&&c.etypeNegotiation&&this.key.keytype!==krb.supportedEnctypes[0]){var h=[{adType:krb.AD_ETYPE_NEGOTIATION,adData:krb.EtypeList.encodeDER(krb.supportedEnctypes)}],i={adType:krb.AD_IF_RELEVANT_TYPE,adData:krb.AD_IF_RELEVANT.encodeDER(h)};e.authorizationData=[i]}return d.authenticator=this.key.encryptAs(krb.Authenticator,a,e),{apReq:d,subkey:f,seqNumber:g,authenticator:e}}}();